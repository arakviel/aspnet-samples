# üìö –ü–æ–∫—Ä–æ–∫–æ–≤–∏–π –≥—ñ–¥ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤: ASP.NET Core Identity

–¶–µ–π –≥—ñ–¥ –¥–æ–ø–æ–º–æ–∂–µ –≤–∞–º –∑—Ä–æ–∑—É–º—ñ—Ç–∏, —è–∫ –ø—Ä–∞—Ü—é—î –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è –≤ ASP.NET Core Identity.

## üéØ –©–æ –≤–∏ –¥—ñ–∑–Ω–∞—î—Ç–µ—Å—å

1. –Ø–∫ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ ASP.NET Core Identity
2. –Ø–∫ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –º–æ–¥–µ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
3. –Ø–∫ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –±–∞–∑—É –¥–∞–Ω–∏—Ö
4. –Ø–∫ —Å—Ç–≤–æ—Ä–∏—Ç–∏ API –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
5. –Ø–∫ –∑–∞—Ö–∏—Å—Ç–∏—Ç–∏ –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏
6. –Ø–∫ —Ç–µ—Å—Ç—É–≤–∞—Ç–∏ API

## üìã –ö—Ä–æ–∫ 1: –†–æ–∑—É–º—ñ–Ω–Ω—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –ø—Ä–æ—î–∫—Ç—É

### –û—Å–Ω–æ–≤–Ω—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏:

**Models/User.cs** - –ú–æ–¥–µ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
```csharp
public class User : IdentityUser
{
    public string? FirstName { get; set; }
    public string? LastName { get; set; }
    // IdentityUser –≤–∂–µ –º—ñ—Å—Ç–∏—Ç—å: Id, UserName, Email, PasswordHash —Ç–æ—â–æ
}
```

**Data/ApplicationDbContext.cs** - –ö–æ–Ω—Ç–µ–∫—Å—Ç –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
```csharp
public class ApplicationDbContext : IdentityDbContext<User>
{
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å—Ç–≤–æ—Ä—é—î —Ç–∞–±–ª–∏—Ü—ñ –¥–ª—è Identity
}
```

## üìã –ö—Ä–æ–∫ 2: –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–µ—Ä–≤—ñ—Å—ñ–≤

### –£ —Ñ–∞–π–ª—ñ Program.cs:

1. **–î–æ–¥–∞–≤–∞–Ω–Ω—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö:**
```csharp
builder.Services.AddDbContext<ApplicationDbContext>(options =>
    options.UseSqlite(connectionString));
```

2. **–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó:**
```csharp
builder.Services.AddAuthentication(IdentityConstants.ApplicationScheme)
    .AddCookie(IdentityConstants.ApplicationScheme)      // –î–ª—è –≤–µ–±-–¥–æ–¥–∞—Ç–∫—ñ–≤
    .AddBearerToken(IdentityConstants.BearerScheme);     // –î–ª—è API
```

3. **–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Identity:**
```csharp
builder.Services.AddIdentityCore<User>(options =>
{
    options.Password.RequiredLength = 6;
    options.User.RequireUniqueEmail = true;
})
.AddEntityFrameworkStores<ApplicationDbContext>()
.AddApiEndpoints();
```

## üìã –ö—Ä–æ–∫ 3: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏

### MapIdentityApi<User>() —Å—Ç–≤–æ—Ä—é—î:

- `POST /register` - –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è
- `POST /login` - –í—Ö—ñ–¥
- `POST /refresh` - –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω–∞
- `POST /forgotPassword` - –í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–∞—Ä–æ–ª—è
- `POST /resetPassword` - –°–∫–∏–¥–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—è

### –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:

**–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è:**
```json
POST /register
{
  "email": "user@example.com",
  "password": "Password123!"
}
```

**–õ–æ–≥—ñ–Ω:**
```json
POST /login
{
  "email": "user@example.com",
  "password": "Password123!"
}
```

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:**
```json
{
  "tokenType": "Bearer",
  "accessToken": "eyJhbGciOiJIUzI1NiIs...",
  "expiresIn": 3600,
  "refreshToken": "CfDJ8..."
}
```

## üìã –ö—Ä–æ–∫ 4: –ö–∞—Å—Ç–æ–º–Ω—ñ –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏

### –ó–∞—Ö–∏—â–µ–Ω–∏–π –µ–Ω–¥–ø–æ—ñ–Ω—Ç:
```csharp
app.MapGet("/auth/profile", async (ClaimsPrincipal claims, ApplicationDbContext context) =>
{
    var userId = claims.FindFirst(ClaimTypes.NameIdentifier)?.Value;
    var user = await context.Users.FindAsync(userId);
    return Results.Ok(user);
})
.RequireAuthorization(); // –í–∏–º–∞–≥–∞—î —Ç–æ–∫–µ–Ω!
```

### –û—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:
```csharp
var userId = claims.FindFirst(ClaimTypes.NameIdentifier)?.Value;
var userName = claims.FindFirst(ClaimTypes.Name)?.Value;
var email = claims.FindFirst(ClaimTypes.Email)?.Value;
```

## üìã –ö—Ä–æ–∫ 5: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### 1. –ó–∞–ø—É—Å—Ç—ñ—Ç—å –¥–æ–¥–∞—Ç–æ–∫:
```bash
dotnet run
```

### 2. –í—ñ–¥–∫—Ä–∏–π—Ç–µ Swagger:
```
https://localhost:7000/swagger
```

### 3. –ó–∞—Ä–µ—î—Å—Ç—Ä—É–π—Ç–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:
- –ó–Ω–∞–π–¥—ñ—Ç—å –µ–Ω–¥–ø–æ—ñ–Ω—Ç `/register`
- –í–≤–µ–¥—ñ—Ç—å email —Ç–∞ –ø–∞—Ä–æ–ª—å
- –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "Execute"

### 4. –£–≤—ñ–π–¥—ñ—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É:
- –ó–Ω–∞–π–¥—ñ—Ç—å –µ–Ω–¥–ø–æ—ñ–Ω—Ç `/login`
- –í–≤–µ–¥—ñ—Ç—å —Ç—ñ –∂ –¥–∞–Ω—ñ
- –°–∫–æ–ø—ñ—é–π—Ç–µ `accessToken` –∑ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ

### 5. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –≤ Swagger:
- –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É "Authorize" –≤–≥–æ—Ä—ñ
- –í–≤–µ–¥—ñ—Ç—å: `Bearer –≤–∞—à_—Ç–æ–∫–µ–Ω`
- –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "Authorize"

### 6. –¢–µ—Å—Ç—É–π—Ç–µ –∑–∞—Ö–∏—â–µ–Ω—ñ –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏:
- –°–ø—Ä–æ–±—É–π—Ç–µ `/auth/profile`
- –°–ø—Ä–æ–±—É–π—Ç–µ `/auth/users`

## üìã –ö—Ä–æ–∫ 6: –†–æ–∑—É–º—ñ–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏

### –•–µ—à—É–≤–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—ñ–≤:
```csharp
// Identity –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ö–µ—à—É—î –ø–∞—Ä–æ–ª—ñ
// –ù—ñ–∫–æ–ª–∏ –Ω–µ –∑–±–µ—Ä—ñ–≥–∞–π—Ç–µ –ø–∞—Ä–æ–ª—ñ —É –≤—ñ–¥–∫—Ä–∏—Ç–æ–º—É –≤–∏–≥–ª—è–¥—ñ!
```

### –¢–æ–∫–µ–Ω–∏:
```csharp
// Bearer —Ç–æ–∫–µ–Ω–∏ –º–∞—é—Ç—å –æ–±–º–µ–∂–µ–Ω–∏–π —Ç–µ—Ä–º—ñ–Ω –¥—ñ—ó
// –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ refresh —Ç–æ–∫–µ–Ω–∏ –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
```

### Claims:
```csharp
// Claims - —Ü–µ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤ —Ç–æ–∫–µ–Ω—ñ
// –ù–∞–ø—Ä–∏–∫–ª–∞–¥: ID, —ñ–º'—è, email, —Ä–æ–ª—ñ
```

## üîç –ü—Ä–∞–∫—Ç–∏—á–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è

### –ó–∞–≤–¥–∞–Ω–Ω—è 1: –î–æ–¥–∞–π—Ç–µ –Ω–æ–≤–µ –ø–æ–ª–µ
1. –î–æ–¥–∞–π—Ç–µ –ø–æ–ª–µ `DateOfBirth` –¥–æ –º–æ–¥–µ–ª—ñ `User`
2. –û–Ω–æ–≤—ñ—Ç—å –µ–Ω–¥–ø–æ—ñ–Ω—Ç –ø—Ä–æ—Ñ—ñ–ª—é
3. –°—Ç–≤–æ—Ä—ñ—Ç—å –º—ñ–≥—Ä–∞—Ü—ñ—é

### –ó–∞–≤–¥–∞–Ω–Ω—è 2: –î–æ–¥–∞–π—Ç–µ –≤–∞–ª—ñ–¥–∞—Ü—ñ—é
1. –î–æ–¥–∞–π—Ç–µ –≤–∞–ª—ñ–¥–∞—Ü—ñ—é email
2. –î–æ–¥–∞–π—Ç–µ –≤–∞–ª—ñ–¥–∞—Ü—ñ—é –¥–æ–≤–∂–∏–Ω–∏ —ñ–º–µ–Ω—ñ
3. –î–æ–¥–∞–π—Ç–µ –∫–∞—Å—Ç–æ–º–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫–∏

### –ó–∞–≤–¥–∞–Ω–Ω—è 3: –î–æ–¥–∞–π—Ç–µ —Ä–æ–ª—ñ
1. –°—Ç–≤–æ—Ä—ñ—Ç—å —Ä–æ–ª—ñ "Admin" —Ç–∞ "User"
2. –î–æ–¥–∞–π—Ç–µ –µ–Ω–¥–ø–æ—ñ–Ω—Ç —Ç—ñ–ª—å–∫–∏ –¥–ª—è –∞–¥–º—ñ–Ω—ñ–≤
3. –ü—Ä–æ—Ç–µ—Å—Ç—É–π—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é –∑–∞ —Ä–æ–ª—è–º–∏

## ‚ùì –ß–∞—Å—Ç—ñ –ø–∏—Ç–∞–Ω–Ω—è

**Q: –ß–æ–º—É –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è IdentityUser?**
A: IdentityUser –º—ñ—Å—Ç–∏—Ç—å –≤—Å—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –ø–æ–ª—è –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó: ID, email, —Ö–µ—à –ø–∞—Ä–æ–ª—è —Ç–æ—â–æ.

**Q: –©–æ —Ç–∞–∫–µ Claims?**
A: Claims - —Ü–µ –ø–∞—Ä–∏ –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–Ω—è –∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —â–æ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ —Ç–æ–∫–µ–Ω—ñ.

**Q: –Ø–∫ –ø—Ä–∞—Ü—é—î Bearer —Ç–æ–∫–µ–Ω?**
A: –ö–ª—ñ—î–Ω—Ç –æ—Ç—Ä–∏–º—É—î —Ç–æ–∫–µ–Ω –ø—Ä–∏ –ª–æ–≥—ñ–Ω—ñ —Ç–∞ –ø–µ—Ä–µ–¥–∞—î –π–æ–≥–æ –≤ –∑–∞–≥–æ–ª–æ–≤–∫—É `Authorization: Bearer —Ç–æ–∫–µ–Ω`.

**Q: –ß–æ–º—É –ø–æ—Ç—Ä—ñ–±–µ–Ω Refresh —Ç–æ–∫–µ–Ω?**
A: Access —Ç–æ–∫–µ–Ω–∏ –º–∞—é—Ç—å –∫–æ—Ä–æ—Ç–∫–∏–π —Ç–µ—Ä–º—ñ–Ω –¥—ñ—ó –¥–ª—è –±–µ–∑–ø–µ–∫–∏. Refresh —Ç–æ–∫–µ–Ω–∏ –¥–æ–∑–≤–æ–ª—è—é—Ç—å –æ—Ç—Ä–∏–º–∞—Ç–∏ –Ω–æ–≤–∏–π access —Ç–æ–∫–µ–Ω.

## üéì –í–∏—Å–Ω–æ–≤–∫–∏

–í–∏ –Ω–∞–≤—á–∏–ª–∏—Å—å:
- ‚úÖ –ù–∞–ª–∞—à—Ç–æ–≤—É–≤–∞—Ç–∏ ASP.NET Core Identity
- ‚úÖ –°—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ API –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
- ‚úÖ –ó–∞—Ö–∏—â–∞—Ç–∏ –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏
- ‚úÖ –ü—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ —Ç–æ–∫–µ–Ω–∞–º–∏
- ‚úÖ –¢–µ—Å—Ç—É–≤–∞—Ç–∏ API

–¢–µ–ø–µ—Ä –≤–∏ –º–æ–∂–µ—Ç–µ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –±–µ–∑–ø–µ—á–Ω—ñ –≤–µ–±-–¥–æ–¥–∞—Ç–∫–∏ –∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—î—é!
