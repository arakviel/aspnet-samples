# ASP.NET Core Minimal API - –ö–∞—Å—Ç–æ–º–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó

## –û–ø–∏—Å –ø—Ä–æ—î–∫—Ç—É

–¶–µ–π –ø—Ä–æ—î–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è **–∫–∞—Å—Ç–æ–º–Ω–æ—ó —Å–∏—Å—Ç–µ–º–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó —á–µ—Ä–µ–∑ –∫—É–∫–∏** –∑ –Ω—É–ª—è –¥–ª—è ASP.NET Core Minimal API.
–ü—Ä–æ—î–∫—Ç —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –¥–ª—è –Ω–∞–≤—á–∞–ª—å–Ω–∏—Ö —Ü—ñ–ª–µ–π, —â–æ–± –ø–æ–∫–∞–∑–∞—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞–º, —è–∫ –ø—Ä–∞—Ü—é—î –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è "–ø—ñ–¥ –∫–∞–ø–æ—Ç–æ–º" —É ASP.NET Core.

## –ú–µ—Ç–∞ –ø—Ä–æ—î–∫—Ç—É

- üìö **–ù–∞–≤—á–∞–ª—å–Ω–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è** –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ—Ö –º–µ—Ö–∞–Ω—ñ–∑–º—ñ–≤ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
- üîç **–†–æ–∑—É–º—ñ–Ω–Ω—è –ø—Ä–æ—Ü–µ—Å—ñ–≤** —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è, –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∫—É–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
- üõ†Ô∏è **–ü—Ä–∞–∫—Ç–∏—á–Ω–µ –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è** –≤–ª–∞—Å–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
- üìñ **–î–µ—Ç–∞–ª—å–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è** —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –¥–ª—è –∫—Ä–∞—â–æ–≥–æ —Ä–æ–∑—É–º—ñ–Ω–Ω—è

## –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ—î–∫—Ç—É

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫

```
AspNet.MinimalApi.CustomAuth/
‚îú‚îÄ‚îÄ Models/                     # –ú–æ–¥–µ–ª—ñ –¥–∞–Ω–∏—Ö
‚îÇ   ‚îî‚îÄ‚îÄ User.cs                # –ú–æ–¥–µ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
‚îú‚îÄ‚îÄ Data/                      # –ö–æ–Ω—Ç–µ–∫—Å—Ç –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
‚îÇ   ‚îî‚îÄ‚îÄ AuthDbContext.cs       # EF Core –∫–æ–Ω—Ç–µ–∫—Å—Ç
‚îú‚îÄ‚îÄ Authentication/            # –ö–∞—Å—Ç–æ–º–Ω—ñ –∫–ª–∞—Å–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
‚îÇ   ‚îú‚îÄ‚îÄ CustomCookieAuthenticationDefaults.cs
‚îÇ   ‚îú‚îÄ‚îÄ CustomAuthenticationOptions.cs
‚îÇ   ‚îî‚îÄ‚îÄ CustomAuthenticationTicket.cs
‚îú‚îÄ‚îÄ Services/                  # –ë—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ IUserService.cs
‚îÇ   ‚îî‚îÄ‚îÄ UserService.cs
‚îú‚îÄ‚îÄ Middleware/                # Middleware –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
‚îÇ   ‚îî‚îÄ‚îÄ CustomAuthenticationMiddleware.cs
‚îú‚îÄ‚îÄ Extensions/                # –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è –¥–ª—è DI
‚îÇ   ‚îî‚îÄ‚îÄ CustomAuthenticationExtensions.cs
‚îî‚îÄ‚îÄ Program.cs                 # –ì–æ–ª–æ–≤–Ω–∏–π —Ñ–∞–π–ª –¥–æ–¥–∞—Ç–∫—É
```

### –ö–ª—é—á–æ–≤—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏

#### 1. **CustomAuthenticationTicket**

- –°–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è/–¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Ç—ñ–∫–µ—Ç—ñ–≤ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
- –ó–±–µ—Ä—ñ–≥–∞–Ω–Ω—è claims –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ç–µ—Ä–º—ñ–Ω–æ–º –¥—ñ—ó

#### 2. **CustomAuthenticationMiddleware**

- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫—É–∫–∏ –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É –∑–∞–ø–∏—Ç—ñ
- –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤ HttpContext
- –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É–∫–∏ –ø—Ä–∏ –∫–æ–≤–∑–∞—é—á–æ–º—É —Ç–µ—Ä–º—ñ–Ω—ñ –¥—ñ—ó

#### 3. **CustomAuthenticationExtensions**

- –ú–µ—Ç–æ–¥–∏ `CustomSignInAsync()` —Ç–∞ `CustomSignOutAsync()`
- –ó—Ä—É—á–Ω—ñ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è –¥–ª—è HttpContext
- –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

## –¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó

- **ASP.NET Core 9.0** - Minimal API
- **Entity Framework Core** - ORM –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö
- **SQLite** - –õ–µ–≥–∫–∞ –±–∞–∑–∞ –¥–∞–Ω–∏—Ö –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó
- **System.Text.Json** - –°–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Ç—ñ–∫–µ—Ç—ñ–≤ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó

## –ó–∞–ø—É—Å–∫ –ø—Ä–æ—î–∫—Ç—É

### –ü–µ—Ä–µ–¥—É–º–æ–≤–∏

- .NET 9.0 SDK
- IDE (Visual Studio, Rider, VS Code)

### –ö—Ä–æ–∫–∏ –∑–∞–ø—É—Å–∫—É

1. –ö–ª–æ–Ω—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π
2. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ –ø–∞–ø–∫–∏ –ø—Ä–æ—î–∫—Ç—É:
   ```bash
   cd AspNet.MinimalApi.CustomAuth
   ```
3. –ó–∞–ø—É—Å—Ç—ñ—Ç—å –¥–æ–¥–∞—Ç–æ–∫:
   ```bash
   dotnet run
   ```
4. –í—ñ–¥–∫—Ä–∏–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä —ñ –ø–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞ `http://localhost:5208`

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –¢–µ—Å—Ç–æ–≤—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ

- **Email:** `tom@itstep.org`, **–ü–∞—Ä–æ–ª—å:** `12345`
- **Email:** `bob@itstep.org`, **–ü–∞—Ä–æ–ª—å:** `55555`

### –°—Ü–µ–Ω–∞—Ä—ñ—ó —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è

1. **–í—Ö—ñ–¥ –≤ —Å–∏—Å—Ç–µ–º—É:** –ü–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞ `/login` —Ç–∞ –≤–≤–µ–¥—ñ—Ç—å —Ç–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ
2. **–ó–∞—Ö–∏—â–µ–Ω–∏–π —Ä–µ—Å—É—Ä—Å:** –ü—ñ—Å–ª—è –≤—Ö–æ–¥—É –≤–∏ –ø–æ—Ç—Ä–∞–ø–∏—Ç–µ –Ω–∞ –≥–æ–ª–æ–≤–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É
3. **–í–∏—Ö—ñ–¥:** –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–í–∏–π—Ç–∏ –∑ —Å–∏—Å—Ç–µ–º–∏" –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Å–µ—Å—ñ—ó
4. **–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–∞—Ö–∏—Å—Ç—É:** –°–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ `/` –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó

## –û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó

### –ë–µ–∑–ø–µ–∫–∞ –∫—É–∫–∏

- **HttpOnly:** –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ XSS –∞—Ç–∞–∫
- **Secure:** –ü–µ—Ä–µ–¥–∞—á–∞ —Ç—ñ–ª—å–∫–∏ —á–µ—Ä–µ–∑ HTTPS (—É –ø—Ä–æ–¥–∞–∫—à–µ–Ω—ñ)
- **SameSite:** –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ CSRF –∞—Ç–∞–∫
- **–ö–æ–≤–∑–∞—é—á–∏–π —Ç–µ—Ä–º—ñ–Ω –¥—ñ—ó:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è —Å–µ—Å—ñ—ó

### –°–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Ç—ñ–∫–µ—Ç—ñ–≤

- JSON —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è claims
- Base64 –∫–æ–¥—É–≤–∞–Ω–Ω—è –¥–ª—è –±–µ–∑–ø–µ—á–Ω–æ–≥–æ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –≤ –∫—É—Ü—ñ
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–µ—Ä–º—ñ–Ω—É –¥—ñ—ó –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É –∑–∞–ø–∏—Ç—ñ

### Middleware

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫—É–∫–∏ –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É HTTP –∑–∞–ø–∏—Ç—ñ
- –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è `HttpContext.User` –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
- –í–∏–¥–∞–ª–µ–Ω–Ω—è –Ω–µ–¥—ñ–π—Å–Ω–∏—Ö –∫—É–∫–∏

## –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∑ –Ω–∞—Ç–∏–≤–Ω–∏–º ASP.NET Core

| –ê—Å–ø–µ–∫—Ç       | –ù–∞—Ç–∏–≤–Ω–∏–π ASP.NET Core             | –ù–∞—à–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è                    |
|--------------|-----------------------------------|------------------------------------|
| –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è | `AddAuthentication().AddCookie()` | `AddCustomAuthentication()`        |
| Middleware   | `UseAuthentication()`             | `UseCustomAuthentication()`        |
| –í—Ö—ñ–¥         | `HttpContext.SignInAsync()`       | `HttpContext.CustomSignInAsync()`  |
| –í–∏—Ö—ñ–¥        | `HttpContext.SignOutAsync()`      | `HttpContext.CustomSignOutAsync()` |
| –¢—ñ–∫–µ—Ç–∏       | `AuthenticationTicket`            | `CustomAuthenticationTicket`       |

## –ù–∞–≤—á–∞–ª—å–Ω—ñ —Ü—ñ–ª—ñ

–¶–µ–π –ø—Ä–æ—î–∫—Ç –¥–æ–ø–æ–º–∞–≥–∞—î –∑—Ä–æ–∑—É–º—ñ—Ç–∏:

- üîê –Ø–∫ –ø—Ä–∞—Ü—é—é—Ç—å –∫—É–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
- üìù –ü—Ä–æ—Ü–µ—Å —Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó/–¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó —Ç—ñ–∫–µ—Ç—ñ–≤
- üîÑ –ñ–∏—Ç—Ç—î–≤–∏–π —Ü–∏–∫–ª middleware –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
- üõ°Ô∏è –ü—Ä–∏–Ω—Ü–∏–ø–∏ –±–µ–∑–ø–µ–∫–∏ –≤–µ–±-–∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
- üèóÔ∏è –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä—É —Å–∏—Å—Ç–µ–º–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó ASP.NET Core

## –í–∞–∂–ª–∏–≤—ñ –∑–∞—É–≤–∞–∂–µ–Ω–Ω—è

‚ö†Ô∏è **–î–ª—è –Ω–∞–≤—á–∞–ª—å–Ω–∏—Ö —Ü—ñ–ª–µ–π:**

- –ü–∞—Ä–æ–ª—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —É –≤—ñ–¥–∫—Ä–∏—Ç–æ–º—É –≤–∏–≥–ª—è–¥—ñ
- –í—ñ–¥—Å—É—Ç–Ω—î —Ö–µ—à—É–≤–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—ñ–≤
- –°–ø—Ä–æ—â–µ–Ω–∞ –ª–æ–≥—ñ–∫–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó

üîí **–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É –ø–æ—Ç—Ä—ñ–±–Ω–æ:**

- –•–µ—à—É–≤–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—ñ–≤ (BCrypt, Argon2)
- HTTPS –¥–ª—è –≤—Å—ñ—Ö –∑–∞–ø–∏—Ç—ñ–≤
- –î–æ–¥–∞—Ç–∫–æ–≤—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –±–µ–∑–ø–µ–∫–∏
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ç–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥