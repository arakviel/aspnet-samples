# Simple JWT Auth with Cookies - –ë–µ–∑–ø–µ—á–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥

–ü—Ä–æ—Å—Ç–∏–π –ø—Ä–∏–∫–ª–∞–¥ JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –∑ **HttpOnly cookies** –∑–∞–º—ñ—Å—Ç—å Bearer —Ç–æ–∫–µ–Ω—ñ–≤.

## üç™ –û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ

- ‚úÖ **HttpOnly cookies** - JavaScript –Ω–µ –º–æ–∂–µ –ø—Ä–æ—á–∏—Ç–∞—Ç–∏
- ‚úÖ **Secure cookies** - —Ç—ñ–ª—å–∫–∏ —á–µ—Ä–µ–∑ HTTPS
- ‚úÖ **SameSite=Lax** - –∑–∞—Ö–∏—Å—Ç –≤—ñ–¥ CSRF
- ‚úÖ **14 –¥–Ω—ñ–≤** —Ç–µ—Ä–º—ñ–Ω –¥—ñ—ó
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è** –∑ –∫–æ–∂–Ω–∏–º –∑–∞–ø–∏—Ç–æ–º
- ‚úÖ **–ë–µ–∑ Bearer —Ç–æ–∫–µ–Ω—ñ–≤** - –≤—Å–µ –≤ cookies

## üîí –ë–µ–∑–ø–µ–∫–∞

### –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è cookies:
```csharp
var cookieOptions = new CookieOptions
{
    HttpOnly = true,                    // ‚úÖ –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ XSS
    Secure = true,                      // ‚úÖ –¢—ñ–ª—å–∫–∏ HTTPS
    SameSite = SameSiteMode.Lax,       // ‚úÖ –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ CSRF
    Expires = DateTimeOffset.UtcNow.AddDays(14),
    Path = "/"
};
```

### –ü–µ—Ä–µ–≤–∞–≥–∏ –Ω–∞–¥ localStorage:
- üîí **–ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ XSS** - JavaScript –Ω–µ –º–æ–∂–µ –ø—Ä–æ—á–∏—Ç–∞—Ç–∏
- üîÑ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è** - –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–¥–∞–≤–∞—Ç–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏
- üõ°Ô∏è **SameSite –∑–∞—Ö–∏—Å—Ç** - –±–ª–æ–∫—É—î cross-site –∑–∞–ø–∏—Ç–∏

## üöÄ –ó–∞–ø—É—Å–∫

```bash
cd AspNet.MinimalApi.SimpleJwtWithCookiesAuth
dotnet run
```

–î–æ–¥–∞—Ç–æ–∫ –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π –Ω–∞ `http://localhost:5000`

## üìã API

| –ï–Ω–¥–ø–æ—ñ–Ω—Ç | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å | Cookie |
|----------|-------|------|--------|
| `/` | GET | –ì–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ | –ù—ñ |
| `/login` | POST | –í—Ö—ñ–¥ (–≤—Å—Ç–∞–Ω–æ–≤–ª—é—î cookie) | –í—Å—Ç–∞–Ω–æ–≤–ª—é—î |
| `/register` | POST | –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è (–≤—Å—Ç–∞–Ω–æ–≤–ª—é—î cookie) | –í—Å—Ç–∞–Ω–æ–≤–ª—é—î |
| `/logout` | POST | –í–∏—Ö—ñ–¥ (–≤–∏–¥–∞–ª—è—î cookie) | –í–∏–¥–∞–ª—è—î |
| `/profile` | GET | –ü—Ä–æ—Ñ—ñ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ | –ß–∏—Ç–∞—î |
| `/protected` | GET | –ó–∞—Ö–∏—â–µ–Ω–∏–π —Ä–µ—Å—É—Ä—Å | –ß–∏—Ç–∞—î |
| `/admin` | GET | –¢—ñ–ª—å–∫–∏ –¥–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤ | –ß–∏—Ç–∞—î |
| `/auth/status` | GET | –°—Ç–∞—Ç—É—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó | –ß–∏—Ç–∞—î |

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

–í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ —Ñ–∞–π–ª `test-cookies.http`:

1. **–õ–æ–≥—ñ–Ω** - cookie –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
2. **–ó–∞—Ö–∏—â–µ–Ω—ñ —Ä–µ—Å—É—Ä—Å–∏** - cookie –Ω–∞–¥—Å–∏–ª–∞—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
3. **–õ–æ–≥–∞—É—Ç** - cookie –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ

## üîç –í—ñ–¥–º—ñ–Ω–Ω–æ—Å—Ç—ñ –≤—ñ–¥ Bearer —Ç–æ–∫–µ–Ω—ñ–≤

| –ê—Å–ø–µ–∫—Ç | Bearer —Ç–æ–∫–µ–Ω–∏ | HttpOnly Cookies |
|--------|---------------|------------------|
| **–ó–±–µ—Ä—ñ–≥–∞–Ω–Ω—è** | localStorage/memory | HttpOnly cookie |
| **–ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è** | Manual (Authorization header) | –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ |
| **XSS –∑–∞—Ö–∏—Å—Ç** | ‚ùå –í—Ä–∞–∑–ª–∏–≤—ñ | ‚úÖ –ó–∞—Ö–∏—â–µ–Ω—ñ |
| **CSRF –∑–∞—Ö–∏—Å—Ç** | ‚úÖ –ü—Ä–∏—Ä–æ–¥–Ω–∏–π | ‚úÖ SameSite=Lax |
| **–ó—Ä—É—á–Ω—ñ—Å—Ç—å** | –ü–æ—Ç—Ä—ñ–±–Ω–æ –∫–µ—Ä—É–≤–∞—Ç–∏ | –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ |

## üéì –î–ª—è —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤

### –Ø–∫ –ø—Ä–∞—Ü—é—é—Ç—å HttpOnly cookies:

1. **–õ–æ–≥—ñ–Ω**: –°–µ—Ä–≤–µ—Ä –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î cookie
```http
Set-Cookie: auth_token=jwt_here; HttpOnly; Secure; SameSite=Lax
```

2. **–ó–∞–ø–∏—Ç–∏**: –ë—Ä–∞—É–∑–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –Ω–∞–¥—Å–∏–ª–∞—î cookie
```http
Cookie: auth_token=jwt_here
```

3. **–õ–æ–≥–∞—É—Ç**: –°–µ—Ä–≤–µ—Ä –≤–∏–¥–∞–ª—è—î cookie
```http
Set-Cookie: auth_token=; expires=Thu, 01 Jan 1970 00:00:00 GMT
```

### Middleware –æ–±—Ä–æ–±–∫–∞:
```csharp
public async Task InvokeAsync(HttpContext context)
{
    // –ß–∏—Ç–∞—î–º–æ —Ç–æ–∫–µ–Ω –∑ cookie (–Ω–µ –∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞!)
    var token = context.Request.Cookies["auth_token"];
    
    if (!string.IsNullOrEmpty(token))
    {
        var principal = _jwt.ValidateToken(token);
        if (principal != null)
        {
            context.User = principal;
        }
    }
    
    await _next(context);
}
```

## üÜö –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –ø—ñ–¥—Ö–æ–¥—ñ–≤

### Bearer —Ç–æ–∫–µ–Ω–∏ (SimpleJwtAuth):
```javascript
// –ö–ª—ñ—î–Ω—Ç –∫–µ—Ä—É—î —Ç–æ–∫–µ–Ω–∞–º–∏
localStorage.setItem('token', response.token);
fetch('/api/protected', {
    headers: { 'Authorization': `Bearer ${token}` }
});
```

### HttpOnly Cookies (—Ü–µ–π –ø—Ä–æ–µ–∫—Ç):
```javascript
// –ë—Ä–∞—É–∑–µ—Ä –∫–µ—Ä—É—î cookies –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
fetch('/api/protected', {
    credentials: 'include'  // –í–∫–ª—é—á–∞—î cookies
});
```

## ‚ö†Ô∏è –û–±–º–µ–∂–µ–Ω–Ω—è

- **CORS** - –ø–æ—Ç—Ä—ñ–±–Ω–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ `credentials: 'include'`
- **Subdomain –∞—Ç–∞–∫–∏** - SameSite=Lax –Ω–µ –∑–∞—Ö–∏—â–∞—î –≤—ñ–¥ same-site
- **–†–æ–∑–º—ñ—Ä** - cookies –Ω–∞–¥—Å–∏–ª–∞—é—Ç—å—Å—è –∑ –∫–æ–∂–Ω–∏–º –∑–∞–ø–∏—Ç–æ–º

## üí° –ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏

**HttpOnly Cookies –∫—Ä–∞—â–µ –¥–ª—è:**
- –¢—Ä–∞–¥–∏—Ü—ñ–π–Ω–∏—Ö –≤–µ–±-–¥–æ–¥–∞—Ç–∫—ñ–≤
- –í–∏—Å–æ–∫–æ—ó –±–µ–∑–ø–µ–∫–∏ (–±–∞–Ω–∫–∏, –ø–ª–∞—Ç–µ–∂—ñ)
- –ü—Ä–æ—Å—Ç–æ—Ç–∏ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó

**Bearer —Ç–æ–∫–µ–Ω–∏ –∫—Ä–∞—â–µ –¥–ª—è:**
- Mobile –¥–æ–¥–∞—Ç–∫—ñ–≤
- Cross-origin API
- –ú—ñ–∫—Ä–æ—Å–µ—Ä–≤—ñ—Å–Ω–æ—ó –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏

## üîß –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

```csharp
var cookieOptions = new CookieOptions
{
    HttpOnly = true,
    Secure = true,                      // –û–±–æ–≤'—è–∑–∫–æ–≤–æ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—ñ!
    SameSite = SameSiteMode.Strict,    // –ë—ñ–ª—å—à –∂–æ—Ä—Å—Ç–∫–∏–π –∑–∞—Ö–∏—Å—Ç
    Domain = ".yourdomain.com",        // –î–ª—è subdomains
    Expires = DateTimeOffset.UtcNow.AddDays(7)  // –ö–æ—Ä–æ—Ç—à–∏–π —Ç–µ—Ä–º—ñ–Ω
};
```

–¶–µ–π –ø—Ä–∏–∫–ª–∞–¥ –ø–æ–∫–∞–∑—É—î **–±–µ–∑–ø–µ—á–Ω–∏–π —Å–ø–æ—Å—ñ–±** –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è JWT —Ç–æ–∫–µ–Ω—ñ–≤ –≤ SPA –¥–æ–¥–∞—Ç–∫–∞—Ö! üîí
