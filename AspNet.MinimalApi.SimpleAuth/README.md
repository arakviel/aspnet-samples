# ASP.NET Minimal API - Simple Cookie Authentication

Простий приклад cookie аутентифікації з кастомним middleware в ASP.NET Minimal API.

## Особливості

- **Кастомний middleware** для аутентифікації через cookies
- **BCrypt шифрування** для безпечного зберігання паролів
- **Колекція користувачів** в пам'яті з тестовими даними
- **Реєстрація та логін** з валідацією
- **Простий веб-інтерфейс** для тестування
- **Мінімальна конфігурація** - без Entity Framework, без складних налаштувань
- **Cookie-based аутентифікація** з HttpOnly cookies

## Структура проекту

```
AspNet.MinimalApi.SimpleAuth/
├── Middleware/
│   └── SimpleAuthMiddleware.cs    # Кастомний middleware для аутентифікації
├── Models/
│   └── User.cs                    # Модель користувача та DTO
├── Services/
│   └── UserService.cs             # Сервіс для роботи з користувачами
├── wwwroot/
│   └── index.html                 # Веб-інтерфейс для тестування
├── Program.cs                     # Головний файл з налаштуваннями
├── SimpleAuth.http               # HTTP запити для тестування
└── README.md                     # Цей файл
```

## Як працює

### 1. Кастомний Middleware
`SimpleAuthMiddleware` перевіряє наявність cookie `SimpleAuth` в кожному запиті:
- Якщо cookie є - додає інформацію про аутентифікацію в `HttpContext.Items`
- Якщо cookie немає - позначає користувача як неаутентифікованого

### 2. Сервіс користувачів
`UserService` управляє колекцією користувачів:
- Зберігає користувачів в пам'яті (List<User>)
- Хешує паролі за допомогою BCrypt
- Валідує дані при реєстрації
- Перевіряє паролі при логіні

### 3. Ендпоінти

- `GET /` - Головна сторінка (перенаправляє на index.html)
- `POST /register` - Реєстрація нового користувача
- `POST /login` - Логін з перевіркою пароля (встановлює cookie)
- `POST /logout` - Логаут (видаляє cookie)
- `GET /protected` - Захищений ресурс (потребує аутентифікації)
- `GET /users` - Перегляд користувачів (захищений ендпоінт)
- `GET /auth/status` - Перевірка статусу аутентифікації

### 4. Веб-інтерфейс
Простий HTML з JavaScript для:
- Реєстрації нових користувачів
- Логіну з ім'ям користувача та паролем
- Логауту
- Тестування захищеного ресурсу
- Перегляду списку користувачів

### 5. Тестові користувачі
Додаток автоматично створює тестових користувачів:
- **admin** / admin123
- **user** / user123
- **test** / test123

## Запуск

1. Запустіть проект:
```bash
dotnet run
```

2. Відкрийте браузер: http://localhost:5000

3. Або використовуйте HTTP файл для тестування API

## Тестування

### Через веб-інтерфейс:
1. Введіть ім'я користувача
2. Натисніть "Увійти"
3. Спробуйте "Перевірити захищений ресурс"
4. Натисніть "Вийти" та спробуйте знову

### Через HTTP запити:
Використовуйте файл `SimpleAuth.http` в IDE або curl:

```bash
# Логін
curl -X POST http://localhost:5000/login \
  -H "Content-Type: application/json" \
  -d '{"username":"testuser"}' \
  -c cookies.txt

# Захищений ресурс
curl -X GET http://localhost:5000/protected \
  -b cookies.txt

# Логаут
curl -X POST http://localhost:5000/logout \
  -b cookies.txt
```

## Безпека

⚠️ **Це навчальний приклад!** В продакшені потрібно:

- Використовувати HTTPS (Secure cookies)
- Додати перевірку паролів
- Використовувати JWT або інші токени
- Додати CSRF захист
- Налаштувати правильні cookie options
- Додати rate limiting для логіну

## Розширення

Цей приклад можна розширити:
- Додати базу даних користувачів
- Реалізувати ролі та дозволи
- Додати JWT токени
- Інтегрувати з ASP.NET Core Identity
