# –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É SMS Authentication API

## –û–≥–ª—è–¥ —Ñ–∞–π–ª—ñ–≤

```
AspNet.MinimalApi.AuthSms/
‚îú‚îÄ‚îÄ üìÅ Configuration/
‚îÇ   ‚îî‚îÄ‚îÄ TwilioSettings.cs              # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω—ñ –∫–ª–∞—Å–∏ –¥–ª—è Twilio —Ç–∞ SMS
‚îú‚îÄ‚îÄ üìÅ Data/
‚îÇ   ‚îî‚îÄ‚îÄ ApplicationDbContext.cs        # EF Core –∫–æ–Ω—Ç–µ–∫—Å—Ç –∑ Identity
‚îú‚îÄ‚îÄ üìÅ DTOs/
‚îÇ   ‚îî‚îÄ‚îÄ AuthDtos.cs                   # DTO –¥–ª—è API –∑–∞–ø–∏—Ç—ñ–≤ —Ç–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π
‚îú‚îÄ‚îÄ üìÅ Endpoints/
‚îÇ   ‚îî‚îÄ‚îÄ AuthEndpoints.cs              # Minimal API endpoints
‚îú‚îÄ‚îÄ üìÅ Models/
‚îÇ   ‚îú‚îÄ‚îÄ ApplicationUser.cs            # –†–æ–∑—à–∏—Ä–µ–Ω–∞ –º–æ–¥–µ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
‚îÇ   ‚îî‚îÄ‚îÄ SmsVerificationCode.cs        # –ú–æ–¥–µ–ª—å SMS –∫–æ–¥—ñ–≤ –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
‚îú‚îÄ‚îÄ üìÅ Services/
‚îÇ   ‚îú‚îÄ‚îÄ IAuthService.cs               # –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–µ—Ä–≤—ñ—Å—É –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
‚îÇ   ‚îú‚îÄ‚îÄ AuthService.cs                # –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –ª–æ–≥—ñ–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
‚îÇ   ‚îú‚îÄ‚îÄ ISmsService.cs                # –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å SMS —Å–µ—Ä–≤—ñ—Å—É
‚îÇ   ‚îú‚îÄ‚îÄ SmsService.cs                 # Demo SMS —Å–µ—Ä–≤—ñ—Å (—Ñ–µ–π–∫)
‚îÇ   ‚îú‚îÄ‚îÄ TwilioSmsService.cs           # –†–µ–∞–ª—å–Ω–∏–π Twilio SMS —Å–µ—Ä–≤—ñ—Å
‚îÇ   ‚îî‚îÄ‚îÄ SmsServiceFactory.cs          # –§–∞–±—Ä–∏–∫–∞ –¥–ª—è –≤–∏–±–æ—Ä—É SMS –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
‚îú‚îÄ‚îÄ üìÑ Program.cs                     # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –¥–æ–¥–∞—Ç–∫—É —Ç–∞ DI
‚îú‚îÄ‚îÄ üìÑ appsettings.json               # –û—Å–Ω–æ–≤–Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
‚îú‚îÄ‚îÄ üìÑ appsettings.Development.json   # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –¥–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏
‚îú‚îÄ‚îÄ üìÑ AspNet.MinimalApi.AuthSms.csproj # –§–∞–π–ª –ø—Ä–æ–µ–∫—Ç—É –∑ –ø–∞–∫–µ—Ç–∞–º–∏
‚îú‚îÄ‚îÄ üìÑ README.md                      # –û—Å–Ω–æ–≤–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è
‚îú‚îÄ‚îÄ üìÑ ARCHITECTURE.md                # –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è
‚îú‚îÄ‚îÄ üìÑ TWILIO_SETUP.md               # –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –∑ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Twilio
‚îú‚îÄ‚îÄ üìÑ PROJECT_STRUCTURE.md          # –¶–µ–π —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ üìÑ test-api.sh                   # –¢–µ—Å—Ç–æ–≤–∏–π —Å–∫—Ä–∏–ø—Ç (Demo —Ä–µ–∂–∏–º)
‚îú‚îÄ‚îÄ üìÑ test-twilio.sh                # –¢–µ—Å—Ç–æ–≤–∏–π —Å–∫—Ä–∏–ø—Ç (Twilio —Ä–µ–∂–∏–º)
‚îî‚îÄ‚îÄ üìÑ SMS-Auth-API.postman_collection.json # Postman –∫–æ–ª–µ–∫—Ü—ñ—è
```

## –û–ø–∏—Å –∫–ª—é—á–æ–≤–∏—Ö —Ñ–∞–π–ª—ñ–≤

### üîß –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

**Program.cs**
- –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è Identity, JWT, EF Core
- –í–∏–±—ñ—Ä SMS –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
- –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Swagger —Ç–∞ CORS

**appsettings.json**
- JWT –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
- Twilio –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –¥–ª—è production
- SMS –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

**appsettings.Development.json**
- –ü–µ—Ä–µ–≤–∏–∑–Ω–∞—á–∞—î –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –Ω–∞ "Demo" –¥–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏
- –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ª–æ–≥—É–≤–∞–Ω–Ω—è

### üìä –ú–æ–¥–µ–ª—ñ —Ç–∞ DTO

**Models/ApplicationUser.cs**
- –†–æ–∑—à–∏—Ä—é—î IdentityUser
- –î–æ–¥–∞—î FirstName, LastName, CreatedAt, LastLoginAt
- –ü—ñ–¥—Ç—Ä–∏–º—É—î –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è —Ç–µ–ª–µ—Ñ–æ–Ω—É

**Models/SmsVerificationCode.cs**
- –ó–±–µ—Ä—ñ–≥–∞—î SMS –∫–æ–¥–∏ –∑ —Ç–µ—Ä–º—ñ–Ω–æ–º –¥—ñ—ó
- –ü—ñ–¥—Ç—Ä–∏–º—É—î —Ä—ñ–∑–Ω—ñ —Ü—ñ–ª—ñ (—Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è, –≤—Ö—ñ–¥)
- –û–¥–Ω–æ—Ä–∞–∑–æ–≤–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

**DTOs/AuthDtos.cs**
- SendSmsRequest, VerifySmsRequest
- RegisterRequest, LoginRequest
- AuthResponse, UserInfo, ApiResponse<T>

### üóÑÔ∏è –î–∞–Ω—ñ

**Data/ApplicationDbContext.cs**
- –ù–∞—Å–ª—ñ–¥—É—î IdentityDbContext<ApplicationUser>
- –ù–∞–ª–∞—à—Ç–æ–≤—É—î —ñ–Ω–¥–µ–∫—Å–∏ –¥–ª—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó
- –ö–æ–Ω—Ñ—ñ–≥—É—Ä—É—î –∑–≤'—è–∑–∫–∏ –º—ñ–∂ —Ç–∞–±–ª–∏—Ü—è–º–∏

### üîß –°–µ—Ä–≤—ñ—Å–∏

**Services/IAuthService.cs + AuthService.cs**
- –û—Å–Ω–æ–≤–Ω–∞ –ª–æ–≥—ñ–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
- –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —Ç–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è SMS –∫–æ–¥—ñ–≤
- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è JWT —Ç–æ–∫–µ–Ω—ñ–≤
- –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏

**Services/ISmsService.cs**
- –ó–∞–≥–∞–ª—å–Ω–∏–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è SMS –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ñ–≤
- SendSmsAsync(), SendVerificationCodeAsync()

**Services/SmsService.cs**
- Demo —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è (–ª–æ–≥—É—î –≤ –∫–æ–Ω—Å–æ–ª—å)
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏ —Ç–∞ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è

**Services/TwilioSmsService.cs**
- –†–µ–∞–ª—å–Ω–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ Twilio API
- –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ —Ç–∞ –ª–æ–≥—É–≤–∞–Ω–Ω—è
- –ù–∞–ª–∞—à—Ç–æ–≤—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ TwilioSettings

**Services/SmsServiceFactory.cs**
- –§–∞–±—Ä–∏–∫–∞ –¥–ª—è –≤–∏–±–æ—Ä—É SMS –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥ –¥–æ DI —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó

### üåê API

**Endpoints/AuthEndpoints.cs**
- Minimal API endpoints
- –í–∞–ª—ñ–¥–∞—Ü—ñ—è –≤—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö
- –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫
- Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

### üìã –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

**test-api.sh**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤ Demo —Ä–µ–∂–∏–º—ñ
- –ü–æ–≤–Ω–∏–π —Ü–∏–∫–ª: —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è ‚Üí –≤—Ö—ñ–¥ ‚Üí –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î curl —Ç–∞ jq

**test-twilio.sh**
- –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∑ —Ä–µ–∞–ª—å–Ω–∏–º–∏ SMS —á–µ—Ä–µ–∑ Twilio
- –Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∏–π –≤–≤—ñ–¥ SMS –∫–æ–¥—ñ–≤
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ç–∞ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è

**SMS-Auth-API.postman_collection.json**
- –ì–æ—Ç–æ–≤–∞ –∫–æ–ª–µ–∫—Ü—ñ—è –¥–ª—è Postman
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω—ñ–≤
- –í—Å—ñ endpoints –∑ –ø—Ä–∏–∫–ª–∞–¥–∞–º–∏

### üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

**README.md**
- –û—Å–Ω–æ–≤–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è –ø—Ä–æ–µ–∫—Ç—É
- –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç —Ç–∞ –ø—Ä–∏–∫–ª–∞–¥–∏
- API endpoints —Ç–∞ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è

**ARCHITECTURE.md**
- –î–µ—Ç–∞–ª—å–Ω–∏–π –æ–ø–∏—Å –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏
- –î—ñ–∞–≥—Ä–∞–º–∏ –ø–æ—Ç–æ–∫—ñ–≤ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –¥–ª—è production

**TWILIO_SETUP.md**
- –ü–æ–∫—Ä–æ–∫–æ–≤–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Twilio
- –ë–µ–∑–ø–µ–∫–∞ —Ç–∞ –Ω–∞–π–∫—Ä–∞—â—ñ –ø—Ä–∞–∫—Ç–∏–∫–∏
- –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ —Ç–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥

## –ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ (NuGet –ø–∞–∫–µ—Ç–∏)

```xml
<PackageReference Include="Microsoft.AspNetCore.Identity.EntityFrameworkCore" Version="9.0.8" />
<PackageReference Include="Microsoft.EntityFrameworkCore.InMemory" Version="9.0.8" />
<PackageReference Include="Microsoft.AspNetCore.Authentication.JwtBearer" Version="9.0.8" />
<PackageReference Include="Swashbuckle.AspNetCore" Version="9.0.3" />
<PackageReference Include="Twilio" Version="7.12.0" />
```

## –û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏

### üîÑ Dependency Injection
- –°–µ—Ä–≤—ñ—Å–∏ —Ä–µ—î—Å—Ç—Ä—É—é—Ç—å—Å—è —á–µ—Ä–µ–∑ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏
- –í–∏–±—ñ—Ä SMS –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
- –õ–µ–≥–∫–æ —Ç–µ—Å—Ç—É–≤–∞—Ç–∏ —Ç–∞ –∑–∞–º—ñ–Ω—é–≤–∞—Ç–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏

### üõ°Ô∏è –ë–µ–∑–ø–µ–∫–∞
- JWT —Ç–æ–∫–µ–Ω–∏ –∑ –ø—ñ–¥–ø–∏—Å–æ–º
- –í–∞–ª—ñ–¥–∞—Ü—ñ—è –≤—Å—ñ—Ö –≤—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö
- Rate limiting –¥–ª—è SMS
- –•–µ—à—É–≤–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—ñ–≤ —á–µ—Ä–µ–∑ Identity

### üìà –ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å
- –ß—ñ—Ç–∫–µ —Ä–æ–∑–¥—ñ–ª–µ–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç–µ–π
- –õ–µ–≥–∫–æ –¥–æ–¥–∞–≤–∞—Ç–∏ –Ω–æ–≤—ñ SMS –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∏
- –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ —Ä—ñ–∑–Ω–∏—Ö –±–∞–∑ –¥–∞–Ω–∏—Ö —á–µ—Ä–µ–∑ EF Core

### üß™ –¢–µ—Å—Ç–æ–≤–∞–Ω—ñ—Å—Ç—å
- –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏ –¥–ª—è –≤—Å—ñ—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
- Demo —Ä–µ–∂–∏–º –¥–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ —Ç–µ—Å—Ç–æ–≤—ñ —Å–∫—Ä–∏–ø—Ç–∏

## –ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏ –¥–ª—è —Ä–æ–∑–≤–∏—Ç–∫—É

1. **–î–æ–¥–∞—Ç–∏ unit —Ç–µ—Å—Ç–∏**
   - xUnit –ø—Ä–æ–µ–∫—Ç
   - –ú–æ–∫—É–≤–∞–Ω–Ω—è —Å–µ—Ä–≤—ñ—Å—ñ–≤
   - –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä—ñ–≤

2. **–î–æ–¥–∞—Ç–∏ integration —Ç–µ—Å—Ç–∏**
   - TestServer –¥–ª—è API —Ç–µ—Å—Ç—ñ–≤
   - In-memory –±–∞–∑–∞ –¥–∞–Ω–∏—Ö
   - –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –ø–æ–≤–Ω–∏—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤

3. **–ü–æ–∫—Ä–∞—â–∏—Ç–∏ –±–µ–∑–ø–µ–∫—É**
   - Rate limiting middleware
   - CAPTCHA –¥–ª—è –∑–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –∑–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è–º
   - IP whitelist/blacklist

4. **–î–æ–¥–∞—Ç–∏ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥**
   - Application Insights
   - Structured logging –∑ Serilog
   - Health checks

5. **–†–æ–∑—à–∏—Ä–∏—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å**
   - Refresh —Ç–æ–∫–µ–Ω–∏
   - –î–≤–æ—Ñ–∞–∫—Ç–æ—Ä–Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è
   - –°–æ—Ü—ñ–∞–ª—å–Ω—ñ –º–µ—Ä–µ–∂—ñ (OAuth)
   - Email –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è
